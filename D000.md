# $D000-$D030

## 53248-53264 $D000-$D010 Sprite horizontal and vertical position registers <a name="D000"></a>

The position of each sprite is controlled by a pair of these registers
plus a bit in the register at 53264/$D010. The extra bit
is required because the horizontal position value can exceed
255. The extra bit is effectively the ninth (most significant) bit
of the horizontal position register. The relationship of registers
to sprites is as follow

|Sprite |Horizontal register | Bit in $D010| Vertical register|
|-|-|-|-|
|0| 53248/$D000| 0|53249/$D001|
|1| 53250/$D002| 1|53251/$D003|
|2| 53252/$D004| 2|53253/$D005|
|3| 53254/$D006| 3|53255/$D007|
|4| 53256/$D008| 4|53257/$D009|
|5| 53258/$D00A| 5|53259/$D00B|
|6| 53260/$D00C| 6|53261/$D00D|
|7| 53262/SD00E| 7|53263/SD00F|

The values in these registers specify a sprite's position on
the screen. (Actually, the values set the position of the upper
left corner of the 24 X 21-pixel sprite pattern.) The coordinate
system used is slightly different from the one used for bitmapped
graphics, as illustrated in next figure. Note that the
sprite coordinate system remains the same regardless of the
current screen mode (character or bitmapped) or sprite mode
(standard or multicolor).

![Vic sprite position values](./resources/008-06-f-vic-sprite-position-values.png "Vic sprite position values")

The horizontal position range includes both the active
screen area and the inactive left and right borders, in units
that equal standard screen pixel widths. The vertical position
range also includes the top and bottom borders in addition to
the active screen area. Note that the horizontal position can be
greater than 255, which is the largest value that can be stored
in a horizontal position register. To move a sprite to horizontal
position 256, you must set the horizontal position register to
0/$00 and set the most significant horizontal bit for that sprite
(in the register at 53264/$D010) to %1.

The most significant
bit must remain set for all positions greater than 255. Because
of the extra programming required to move the sprite to this
right portion of the screen, the vertical column at horizontal
position 256 is frequently referred to as the seam.
The values in these registers cannot be changed directly
while the normal BASIC IRQ routine [$A84D] is in use. That
routine copies the contents of the shadow sprite position locations
(4566-4582/$11D6-$11E6) into these registers during
each system IRQ interrupt. There are two
ways to deal with this. The simplest solution is to store the
desired sprite position values in the proper shadow location.

If you wish to use the true registers, you can prevent the execution of
the BASIC portion of the IRQ interrupt. This will disable most
BASIC sprite and sound commands, but that shouldn't be a
problem for machine language programmers. To prevent execution of
the BASIC IRQ routine, you can either set bit 0 of
the initialization status flag at [2564/$0A04](#0A04) to %0 (which tells
the Kernal that BASIC is not initialized), or you can store any
nonzero value in the BASIC IRQ status flag at [4861/$12FD](#12FD).

## 53265 $D011 Vertical smooth scrolling and control register <a name="D011"></a>
**Bits 0-2**: these bits control the VlC's vertical fine scrolling
feature. The value here specifies how many scan lines downward
the display should be shifted. The available three bits
allow the screen to be scrolled up to seven scan lines. The
IOINIT routine [$E109] initializes these bits to %011 = 3, so
the default display will be scrolled down three scan lines from
its highest possible position.
The display scrolls without wrapping; blank scan lines are
moved in from the top and scan lines on the bottom move off
the visible screen. Pixels in scan lines scrolled off the bottom
of the display are not erased. They become visible again if the
display is scrolled back upward by reducing the value in these
bits. The 24-row feature is useful with scrolling because it
creates hidden scan lines at the top and bottom of the screen that
can be scrolled onto the visible area.

**Bit 3**: this bit determines the vertical height of the active
portion of the screen display. Setting this bit to %1 selects a 25-row
(200 scan-line) active screen. The bit is initialized to this
setting during the IOINIT routine [$E109], and neither the
operating system nor BASIC changes this value. Setting this bit
to %0 reduces the height of the active portion of the display
to 24 rows (192 scan lines) by blanking the top four and bottom
four scan lines of the display. The pixels in the blanked
columns aren't erased; they'll still be intact when the screen is
switched back to 25 rows. The 24-row feature is useful in
conjunction with the vertical scrolling feature described in bits 0-2.

**Bit 4**: this bit enables or disables the VIC screen display.
While the bit is %1, the VIC provides its normal screen output.
The bit is initialized to this setting during the IOINIT routine [$E109].
When the bit is set to %0, the VIC suspends the
active portion of the display and provides a solid screen in the
border color specified in the register at [53280/$D020](#D020). The
screen is not erased, just blanked. Any text or graphics will
still be intact if the screen is again enabled. With the display
blanked, the VIC doesn't have to steal timing cycles from the
processor as it normally does. As a result, the 128 actually
runs about 7 percent faster with the VIC display off.
There are several uses for this blanking feature. For example, you
could blank the display while drawing a complex
bitmapped graphics screen, then dramatically unveil the completed
picture by reenabling the display. Since the VIC cannot
provide a proper display at the 2-MHz clock rate, the VIC display
is normally blanked when the system is switched to fast
mode. One step in the BASIC statement FAST involves setting
this bit to %0. The SLOW statement returns it to %1. This bit
is also set to %0 to blank the screen during tape operations,
and restored to %1 upon completion of the operations.

**Bit 5**: this bit selects whether the VDC will generate a character
mode display or a bitmapped mode display.
Setting this bit to %0 selects character mode, while setting it
to %1 selects bitmapped mode.
This bit cannot be directly modified while the normal system interrupt
sequence is active because a step in the screen editor IRQ routine
[$C194] sets this bit according to the screen
mode flag (location 216/$D8). To change the setting of this
bit, you can either store the appropriate value in the flag
location, or you can disable the screen-setup portion of the IRQ
routine and change this bit directly. To use the flag location,
set bit 5 of location 216/$D8 to the desired setting (%0 or %1)
for the register bit. To turn off the screen-setup portion of the
interrupt routine, store the value 255/SFF in location 216/$D8.

**Bit 6**: this bit controls extended background color mode,
which offers a choice of four different background colors for
each character position. For details about this mode, refer to
the introduction for this section. Extended background color
mode is enabled when this bit is set to %1. The mode works
only in conjunction with character mode. You should not select
extended background color mode while bit 5 is set to %1
to select bitmapped mode.

**Bit 7**: this bit is effectively the ninth bit of the raster register
at 53266/$D011. Refer to the discussion of that register for
details. The extra bit is necessary because a full screen contains
more than 256 scan lines.

## 53266 $D012 Raster compare register <a name="D012"></a>
This register has two different functions, depending on
whether it is being read from or written to. As explained in
the introduction for this section, the video screen display
consists of a stack of thin horizontal lines of dots called a raster.
When the register is read, the value returned is the number of
the raster scan line currently being drawn. The range of scanline
numbers depends on the video system in use. For NTSC
(North American) systems, values can be in the range 0-262,
while PAL (European) systems have a maximum count of over
300.

In either case, the active portion of the screen consists of
scan lines 50-249.
The maximum scan-line number in either system is larger
than can be held in a single eight-bit register, so bit 7 of the
register at [53265/$D011](#D011) is used to hold the ninth bit of the
value. When bit 7 of [53265/$D011](#D011) is %1 , you should add
256/ $100 to the value in this register to get the true scan-line
number. For scan line 262, for example, bit 7 of [53265/$D011](#D011)
will be %1 and the value in this register will be 6/$06.

Because
the value in this register changes so rapidly (over 15,000
times per second), it can't be read usefully from BASIC. By the
time you PEEKed the value into a variable, the raster scan line
would have moved far beyond the line recorded in the variable value.
When you write to this register or to bit 7 of [53265/$D011](#D011),
the value written is stored in an internal nine-bit raster
compare latch register. Whenever the current scan-line count
equals the value in this register, bit 0 of the interrupt register
at [53273/$D019](D019) will be set to %1. If bit 0 of the interrupt
mask register at [53274/$D01A](D01A) was previously set to %1, this
will also trigger an external interrupt request to the processor.
The value you store in this register represents the scan line at
which you wish the interrupt to occur.

For scan-line values
less than 256, you must also set bit 7 of [53265/$D011](#D011) to %0.
For scan-line values of 256 or greater, you must set bit 7 of
[53265/$D011](#D011) to %1 and store the line number minus 256 in
this register. To calculate the top scan line corresponding to
any row of character positions, use the following formula:

```
scan line = (row * 8) + 50
```

where the row value is in the range 0-24.

Raster interrupts can be used to program a variety of special
video effects, including split screens like those in the
GRAPHIC 2 and GRAPHIC 4 modes. The 128 also uses a raster interrupt
off the visible screen (at scan line 255) to drive
the system IRQ sequence. Because of this, you cannot write a
new value directly to this register while the the normal system
interrupt sequence is in use. The screen-setup portion of the
screen editor IRQ routine [$C194] will write the value 255/$FF
to this register on every pass, except when setting up the bitmapped
portion of a split bitmapped/text screen. In that case,
the value in location [2612/$0A34](0A34) will be copied into the register.

In either case, bit 7 of the register at [53265/$D011](#D011) will
be set to %0. To use a raster interrupt for your own purposes,
you must write a new interrupt routine.
